(this["webpackJsonpweb-rtc-demo"]=this["webpackJsonpweb-rtc-demo"]||[]).push([[0],{16:function(e,n,t){},18:function(e,n,t){},20:function(e,n,t){"use strict";t.r(n);var a=t(3),s=t.n(a),c=t(9),r=t.n(c),o=(t(16),t(7)),i=t(1),l=t.n(i),u=t(6),d=t(2),h=t(4),g=t(5),f=t(11),m=t(10);var p=function(){function e(){Object(h.a)(this,e),this.peerList=[]}return Object(g.a)(e,[{key:"registryRTCPeer",value:function(e){var n=Math.random().toString(36).substr(2,9);return this.peerList.push({peerId:n,peer:e}),n}},{key:"unregistryRTCPeer",value:function(e){var n=this.peerList.findIndex((function(n){return n.peerId===e}));return n>=0&&(this.peerList.splice(n,1),!0)}},{key:"sendOffer",value:function(e,n){this.peerList.forEach((function(t){t.peerId!==e&&t.peer.receiveOffer(n)}))}},{key:"sendAnswer",value:function(e,n){this.peerList.forEach((function(t){t.peerId!==e&&t.peer.receiveAnswer(n)}))}},{key:"sendIceCandidate",value:function(e,n){this.peerList.forEach((function(t){t.peerId!==e&&t.peer.addIceCandidate(n)}))}}]),e}(),b=(t(18),{ordered:!1,maxRetransmits:0}),v=function(){function e(n){var t=this;Object(h.a)(this,e),this.setupConnection=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.peerId=t.options.signalServer.registryRTCPeer(t),t.connection.addEventListener("icecandidate",function(){var e=Object(d.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.log("ICE candidate:",n.candidate),t.options.signalServer.sendIceCandidate(t.peerId,n.candidate);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),t.connection.addEventListener("datachannel",t.onDataChannel);case 3:case"end":return e.stop()}}),e)}))),this.addIceCandidate=function(e){return t.connection.addIceCandidate(e)},this.close=function(){t.options.signalServer.unregistryRTCPeer(t.peerId),t.connection.close()},this.setupChannel=function(){t.channel=t.connection.createDataChannel("messaging-channel",b),t.onDataChannel({channel:t.channel})},this.onDataChannel=function(e){t.channel=e.channel,t.channel.binaryType="arraybuffer",t.channel.addEventListener("open",(function(){t.log("channel open!"),t.options.onOpen()})),t.channel.addEventListener("close",(function(){t.log("channel closed!"),t.options.onClosed()})),t.channel.addEventListener("message",t.options.onMessage)},this.createOffer=Object(d.a)(l.a.mark((function e(){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.connection.createOffer();case 2:return n=e.sent,t.log("Got offer",JSON.stringify(n)),a=t.connection.setLocalDescription(n),t.options.signalServer.sendOffer(t.peerId,n),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),this.receiveOffer=function(){var e=Object(d.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.connection.setRemoteDescription(n));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.createAnswer=Object(d.a)(l.a.mark((function e(){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.connection.createAnswer();case 2:return n=e.sent,t.log("Got answer",JSON.stringify(n)),a=t.connection.setLocalDescription(n),t.options.signalServer.sendAnswer(t.peerId,n),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),this.receiveAnswer=function(){var e=Object(d.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.connection.setRemoteDescription(n));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.name=n.name,this.options=n,this.connection=new RTCPeerConnection,this.setupConnection()}return Object(g.a)(e,[{key:"log",value:function(){for(var e,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];(e=console).log.apply(e,["[".concat(this.name,"]")].concat(t))}}]),e}(),j=t(0),O=function(e){Object(f.a)(t,e);var n=Object(m.a)(t);function t(e){var a;return Object(h.a)(this,t),(a=n.call(this,e)).disconnect=function(){a._localPeer.close(),a._remotePeer.close()},a.connect=Object(d.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("connect!"),e.prev=1,n={signalServer:a.signalServer,onOpen:function(){a.setState({connected:!0})},onClosed:function(){a.setState({connected:!1})}},a._localPeer=new v(Object(u.a)(Object(u.a)({},n),{},{name:"local peer",onMessage:a._onLocalMessageReceived})),a._remotePeer=new v(Object(u.a)(Object(u.a)({},n),{},{name:"remote peer",onMessage:a._onRemoteMessageReceived})),a._localPeer.setupChannel(),e.next=8,a._localPeer.createOffer();case 8:return e.next=10,a._remotePeer.createAnswer();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),a._onLocalMessageReceived=function(e){console.log("Remote message received by local: ".concat(e.data)),a.setState({localMessages:a.state.localMessages+"> "+e.data+"\n"})},a._onRemoteMessageReceived=function(e){console.log("Local message received by remote: ".concat(e.data)),a.setState({remoteMessages:a.state.remoteMessages+"> "+e.data+"\n"})},a._sendMessage=function(e,n){""!==e?(console.log("Sending remote message: ",e),n.send(e)):console.log("Not sending empty message!")},a._handleChangeValue=function(e,n){a.setState(Object(o.a)({},n,e))},a.state={connected:!1,localMessages:"",remoteMessages:"",localOutMessage:"",remoteOutMessage:""},a}return Object(g.a)(t,[{key:"componentDidMount",value:function(){this.signalServer=new p}},{key:"componentWillUnmount",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.connected&&this.disconnect();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(j.jsxs)("section",{children:[Object(j.jsxs)("div",{className:"controlPanel",children:[Object(j.jsx)("button",{disabled:this.state.connected,onClick:this.connect,children:"Connect"}),Object(j.jsx)("button",{disabled:!this.state.connected,onClick:this.disconnect,children:"Disconnect"})]}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"column",children:[Object(j.jsx)("h1",{children:"Local"}),Object(j.jsxs)("div",{className:"messageBox",children:[Object(j.jsx)("label",{htmlFor:"localOutgoing",children:"Local outgoing message:"}),Object(j.jsx)("textarea",{className:"message",id:"localOutgoing",value:this.state.localOutMessage,onChange:function(n){return e._handleChangeValue(n.target.value,"localOutMessage")}}),Object(j.jsx)("button",{disabled:!this.state.connected,onClick:function(n){return e._sendMessage(e.state.localOutMessage,e._localPeer.channel)},id:"sendLocal",children:"Send Message from Local"})]}),Object(j.jsxs)("div",{className:"messageBox",children:[Object(j.jsx)("label",{htmlFor:"localIncoming",children:"Local incoming messages:"}),Object(j.jsx)("textarea",{className:"message",id:"localIncoming",disabled:!0,value:this.state.localMessages})]})]}),Object(j.jsxs)("div",{className:"column",children:[Object(j.jsx)("h1",{children:"Remote"}),Object(j.jsxs)("div",{className:"messageBox",children:[Object(j.jsx)("label",{htmlFor:"remoteOutgoing",children:"Remote outgoing message:"}),Object(j.jsx)("textarea",{className:"message",id:"remoteOutgoing",value:this.state.remoteOutMessage,onChange:function(n){return e._handleChangeValue(n.target.value,"remoteOutMessage")}}),Object(j.jsx)("button",{disabled:!this.state.connected,onClick:function(n){return e._sendMessage(e.state.remoteOutMessage,e._remotePeer.channel)},id:"sendRemote",children:"Send Message from Remote"})]}),Object(j.jsxs)("div",{className:"messageBox",children:[Object(j.jsx)("label",{htmlFor:"remoteIncoming",children:"Remote incoming messages:"}),Object(j.jsx)("textarea",{className:"message",id:"remoteIncoming",disabled:!0,value:this.state.remoteMessages})]})]})]})]})}}]),t}(a.Component),x=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,21)).then((function(n){var t=n.getCLS,a=n.getFID,s=n.getFCP,c=n.getLCP,r=n.getTTFB;t(e),a(e),s(e),c(e),r(e)}))};r.a.render(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(O,{})}),document.getElementById("root")),x()}},[[20,1,2]]]);
//# sourceMappingURL=main.21768903.chunk.js.map